Moved the switch statement to executionCycle() and some minor changes.
